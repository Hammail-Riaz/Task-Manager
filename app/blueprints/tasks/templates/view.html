{% extends 'base.html' %}
{% block title %}Task Manager - View Tasks{% endblock %}

{% block content %}
<div class="container-fluid py-5">

    <h1 class="mb-4 text-center">ğŸ“‹ Your Tasks</h1>

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=True) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert neon-alert {{ category }} mb-3 text-center">
        {{ message }}
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}


    <form method="get" action="{{ url_for('tasks.view') }}" class="mb-4 text-center">
        <select name="status" class="custom-dropdown" onchange="this.form.submit()">
            <option value="All" {% if request.args.get('status')=='All' %}selected{% endif %}>All</option>
            <option value="In Progress" {% if request.args.get('status')=='In Progress' %}selected{% endif %}>In
                Progress</option>
            <option value="Pending" {% if request.args.get('status')=='Pending' %}selected{% endif %}>Pending</option>
            <option value="Cancelled" {% if request.args.get('status')=='Cancelled' %}selected{% endif %}>Cancelled
            </option>
            <option value="Completed" {% if request.args.get('status')=='Completed' %}selected{% endif %}>Completed
            </option>
            <option value="Created Today" {% if request.args.get('status')=='Created Today' %}selected{% endif %}>
                Created Today</option>
        </select>
    </form>


    {% if tasks %}
    <div class="d-flex flex-column gap-4">
        {% for task in tasks %}
        <div class="content-container p-4 w-100">
            <h3 class="mb-2">{{ task.title }}</h3>
            <h5 class="mb-3">{{ task.date_n_time }}</h5>
            <p>{{ task.description }}</p>
            <p>Status:
                {% if task.status == 'Completed' %}
                <span class="badge bg-success">{{ task.status }}</span>
                {% elif task.status == 'In Progress' %}
                <span class="badge bg-warning text-dark">{{ task.status }}</span>
                {% elif task.status == 'Cancelled' %}
                <span class="badge bg-danger">{{ task.status }}</span>
                {% elif task.status == 'Pending' %}
                <span class="badge bg-info text-dark">{{ task.status }}</span>
                {% else %}
                <span class="badge bg-secondary">{{ task.status }}</span>
                {% endif %}
            </p>

            <div class="d-flex justify-content-end mt-3 gap-2">
                <a href="{{ url_for('tasks.edit', tid=task.tid) }}" class="btn btn-sm btn-custom">âœï¸ Edit</a>
                <form method="POST" action="{{ url_for('tasks.delete', tid=task.tid) }}"
                    onsubmit="return confirm('Are you sure you want to delete this task?');">
                    {{ form.hidden_tag() }}
                    <button type="submit" class="btn btn-sm btn-custom">ğŸ—‘ Delete</button>
                </form>

            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="content-container text-center p-5">
        <p class="fs-5">No tasks found for this filter. ğŸ“</p>
    </div>
    {% endif %}

</div>

{% endblock %}